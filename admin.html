<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WonderLens AI - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #030712; color: #F8FAFC; font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">WonderLens AI - Form Submissions</h1>
        
        <div id="stats" class="grid grid-cols-3 gap-4 mb-8">
            <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
                <div class="text-sm text-slate-400">Total Submissions</div>
                <div id="total-count" class="text-2xl font-bold text-brand-accent">-</div>
            </div>
            <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
                <div class="text-sm text-slate-400">Unique Companies</div>
                <div id="companies-count" class="text-2xl font-bold text-brand-accent">-</div>
            </div>
            <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
                <div class="text-sm text-slate-400">Last Updated</div>
                <div id="last-update" class="text-sm text-slate-300">-</div>
            </div>
        </div>

        <div class="mb-4 flex gap-4">
            <button onclick="loadSubmissions()" class="bg-cyan-500 hover:bg-cyan-400 text-black px-4 py-2 rounded font-bold">
                Refresh Data
            </button>
            <button onclick="exportCSV()" class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded">
                Export CSV
            </button>
        </div>

        <div id="loading" class="text-center py-8 text-slate-400">Loading submissions...</div>
        <div id="error" class="hidden bg-red-900/20 border border-red-500/50 p-4 rounded mb-4"></div>
        <div id="submissions" class="space-y-4"></div>
    </div>

    <script>
        let submissionsData = [];

        async function loadSubmissions() {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const submissions = document.getElementById('submissions');
            
            loading.classList.remove('hidden');
            error.classList.add('hidden');
            submissions.innerHTML = '';

            try {
                const response = await fetch('/api/submissions');
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to load submissions');
                }

                submissionsData = data.submissions || [];
                
                // Update stats
                document.getElementById('total-count').textContent = data.count || 0;
                document.getElementById('companies-count').textContent = data.companies || 0;
                document.getElementById('last-update').textContent = new Date().toLocaleString();

                // Display submissions
                if (submissionsData.length === 0) {
                    submissions.innerHTML = '<div class="text-center py-8 text-slate-400">No submissions yet. Submit the form to see data here.</div>';
                } else {
                    submissions.innerHTML = submissionsData.map(sub => `
                        <div class="bg-slate-800 border border-slate-700 rounded-lg p-6">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 class="text-xl font-bold text-white">${sub.name || 'N/A'}</h3>
                                    <p class="text-cyan-400">${sub.company || 'N/A'}</p>
                                </div>
                                <div class="text-right text-sm text-slate-400">
                                    <div>${new Date(sub.timestamp).toLocaleString()}</div>
                                    <div class="text-xs mt-1">ID: ${sub.id}</div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                <div>
                                    <div class="text-slate-400">Email</div>
                                    <div class="text-white"><a href="mailto:${sub.email}" class="text-cyan-400 hover:underline">${sub.email || 'N/A'}</a></div>
                                </div>
                                <div>
                                    <div class="text-slate-400">Phone</div>
                                    <div class="text-white">${sub.phone || 'N/A'}</div>
                                </div>
                                <div>
                                    <div class="text-slate-400">Industry</div>
                                    <div class="text-white">${sub.industry || 'N/A'}</div>
                                </div>
                                <div>
                                    <div class="text-slate-400">Use Case</div>
                                    <div class="text-white">${sub.useCase ? (sub.useCase.length > 50 ? sub.useCase.substring(0, 50) + '...' : sub.useCase) : 'N/A'}</div>
                                </div>
                            </div>
                            ${sub.useCase ? `<div class="mt-4 pt-4 border-t border-slate-700">
                                <div class="text-slate-400 text-sm mb-1">Full Use Case:</div>
                                <div class="text-white">${sub.useCase}</div>
                            </div>` : ''}
                        </div>
                    `).join('');
                }

                loading.classList.add('hidden');
            } catch (err) {
                loading.classList.add('hidden');
                error.classList.remove('hidden');
                error.innerHTML = `<strong>Error:</strong> ${err.message}`;
            }
        }

        function exportCSV() {
            if (submissionsData.length === 0) {
                alert('No data to export. Load submissions first.');
                return;
            }

            const headers = ['Timestamp', 'Name', 'Company', 'Email', 'Phone', 'Industry', 'Use Case'];
            const rows = submissionsData.map(s => [
                s.timestamp,
                s.name,
                s.company,
                s.email,
                s.phone,
                s.industry,
                s.useCase
            ]);

            const csv = [
                headers.join(','),
                ...rows.map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(','))
            ].join('\n');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `wonderlens-submissions-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        // Load on page load
        loadSubmissions();
        
        // Auto-refresh every 30 seconds
        setInterval(loadSubmissions, 30000);
    </script>
</body>
</html>
